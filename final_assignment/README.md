# Kubernetes Assignment

This a cloned from original assigment repo from [ Tw labs](https://github.com/twlabs/ROTC-semi-guided-material/blob/main/vim_tips.md).
It is enhanced now to support both docker based and kubernetes based deployment for the resources.

## Pre-requisites
You should have Rancher started with the current version of kubernetes active.

## Testing the App in Docker-Compose
You can run the following to bring up the solution:
```
docker-compose up
```

Now you should be able to access `http://localhost:8000/users` in a web browser and it should return `[]` if it's the first time you've accessed it. Now you can test the API using the curl commands previously shared above.
Once you are finished testing it out we recommend running the following to properly decommission the containers:

```
docker-compose down
```

## Testing the App in k8s
You can run the following to bring up the solution:
Navigated to the final_assignment/k8s folder and run the following command:
```
kubectl apply -f .
```

Now you should be able to access `http://localhost:8000/users` in a web browser and it should return `[]` if it's the first time you've accessed it. Now you can test the API using the curl commands previously shared above.
Once you are finished testing it out we recommend running the following to properly decommission the resources:

```
kubectl delete all --all -n crud-app
```

## App Usage

The REST API is extremely basic, there's no data validation or paramatisation from a security stand point as it still is an MVP. It currently provides basic CRUD capabilities for user data. To understand what data we can send the REST API you need to know the 'user' class which is defined as follows (Id is generated by the database):

```
type User struct {
	ID    int    `json:"id"`
	Name  string `json:"name"`
	Email string `json:"email"`
}
```

Here are the REST API routes:

```
	router.HandleFunc("/users", getUsers(db)).Methods("GET")
	router.HandleFunc("/users/{id}", getUser(db)).Methods("GET")
	router.HandleFunc("/users", createUser(db)).Methods("POST")
	router.HandleFunc("/users/{id}", updateUser(db)).Methods("PUT")
	router.HandleFunc("/users/{id}", deleteUser(db)).Methods("DELETE")
```

Knowing this information we can now use curl to get a list of all users (the array will be empty to start):

```
curl -X GET http://localhost:8000/users
```

We can also use curl to add a new user using the REST API:

```
curl -X POST http://localhost:8000/users -d '{"name":"John Doe", "email":"jdoe@example.com"}' -H "Content-Type: application/json"
```

This should return a json object with an Id along with the data passed in. This indicates that the command worked. You can now either run a curl command or access the web browser at the address `http://localhost:8000/users` to confirm the user has been added.

You should be able to test out any of the REST API routes with this application. For example you can delete a user with the following curl cmd:

```
curl -X DELETE http://localhost:8000/users/1 -H "Content-Type: application/json"
```
